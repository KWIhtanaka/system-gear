# システムギア様向けECサイト機能拡張 画面ワイヤーフレーム・API詳細設計

---

## 1. 主要画面ワイヤーフレーム（例）

### 1.1. ダッシュボード
```
+------------------------------------------------------+
| [ロゴ]  ダッシュボード                              |
+------------------------------------------------------+
| 取込状況サマリ  |  エラー件数  |  仕入先別状況        |
|-----------------|-------------|----------------------|
| [最新バッチ状況] | [エラー数]  | [仕入先ごと一覧]      |
+------------------------------------------------------+
| [商品検索] [取込管理] [マッピング設定] [ユーザー管理] |
+------------------------------------------------------+
```

### 1.2. 商品検索・一覧
```
+------------------------------------------------------+
| 商品検索                                            |
+------------------------------------------------------+
| 検索条件: [商品名] [型番] [仕入先] [在庫] [価格]     |
| [検索] [リセット]                                   |
+------------------------------------------------------+
| 商品一覧（ページング・ソート・CSV出力）              |
|------------------------------------------------------|
| 商品ID | 型番 | 名称 | 在庫 | 価格 | 仕入先 | 詳細 |
|------------------------------------------------------|
| ...                                              ... |
+------------------------------------------------------+
```

### 1.3. マッピング設定画面
```
+------------------------------------------------------+
| マッピング設定（仕入先選択: [▼]）                   |
+------------------------------------------------------+
| 取込ファイル項目 | 自社DB項目 | 型変換 | 条件 | ... |
|------------------------------------------------------|
| Manufacturer      | manufacturers_name | str   |     |
| PartNo            | products_model     | str   |     |
| ...                                              ... |
+------------------------------------------------------+
| [新規追加] [インポート] [エクスポート] [保存]         |
+------------------------------------------------------+
| サンプルデータプレビュー                            |
+------------------------------------------------------+
```

### 1.4. エラー管理・修正画面
```
+------------------------------------------------------+
| エラー管理                                          |
+------------------------------------------------------+
| エラー一覧（仕入先・項目・内容でフィルタ）           |
|------------------------------------------------------|
| バッチNo | 仕入先 | 項目 | エラー内容 | 修正 | 再取込 |
|------------------------------------------------------|
| ...                                              ... |
+------------------------------------------------------+
```

---

## 2. API詳細設計

### 2.1. 商品一覧取得
- **GET /api/products**
#### リクエストパラメータ
| パラメータ | 型 | 必須 | 説明 |
|------------|----|------|------|
| name       | string | 任意 | 商品名部分一致 |
| model      | string | 任意 | 型番部分一致   |
| supplier   | string | 任意 | 仕入先名       |
| page       | int    | 任意 | ページ番号     |
| size       | int    | 任意 | 1ページ件数     |

#### レスポンス例
```json
{
  "total": 123,
  "items": [
    {"id": 1, "model": "ABC123", "name": "抵抗器", "stock": 100, "price": 12.5, "supplier": "A2Global"},
    ...
  ]
}
```

#### バリデーション・エラー例
- page, sizeは正の整数
- 400: 不正なパラメータ

---

### 2.2. マッピングルール一覧取得
- **GET /api/mapping-rules?supplier=xxx**
#### リクエストパラメータ
| パラメータ | 型 | 必須 | 説明 |
|------------|----|------|------|
| supplier   | string | 必須 | 仕入先名 |

#### レスポンス例
```json
[
  {"id": 1, "file_field": "Manufacturer", "db_field": "manufacturers_name", "type": "str", "condition": null, "fixed_value": null},
  ...
]
```

#### バリデーション・エラー例
- supplier必須
- 404: 仕入先未登録

---

### 2.3. マッピングルール登録・更新
- **POST /api/mapping-rules**
#### リクエスト例
```json
{
  "supplier": "A2Global",
  "rules": [
    {"file_field": "Manufacturer", "db_field": "manufacturers_name", "type": "str", "condition": null, "fixed_value": null},
    ...
  ]
}
```
#### レスポンス例
```json
{"result": "ok"}
```
#### バリデーション・エラー例
- supplier必須
- rules配列必須
- 400: 不正な項目名や型

---

### 2.4. 取込データバッチ実行
- **POST /api/external-stock/import**
#### リクエスト例
- multipart/form-dataでファイルアップロード
- supplierパラメータ必須

#### レスポンス例
```json
{"result": "ok", "import_id": 123}
```
#### バリデーション・エラー例
- ファイル必須
- supplier必須
- 400: フォーマット不正

---

### 2.5. エラー一覧取得
- **GET /api/external-stock/errors?import_id=123**
#### レスポンス例
```json
[
  {"row": 5, "field": "price", "error": "数値変換エラー"},
  ...
]
```

---

## 3. 補足
- 画面デザインはVuetify等のUIフレームワークを想定
- APIは全てJWT認証・権限チェック付き
- 詳細な画面デザインやAPI仕様書（OpenAPI/Swagger形式）も別途作成可能 