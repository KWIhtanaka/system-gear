
# システムギア様向け ECサイト機能拡張の資料の検討

## 現状整理

### ECサービス展開中：
半導体および電子部品を商材として取り扱っていますが、現在の取り扱い点数が限定的であり、大きな収益を生む状態ではありません。

### 背景：
現行システムとの共存および連携が必要で、スモールスタートを推進。大規模な投資は行えず、段階的に拡充を目指します。システム保守は低コストで運用できることが前提です。

### ビジネスニーズ：
- 商品取り扱い点数を増加させ、一定の収益を上げる。
- 競合他社との差別化を図り、集客力を高める。
- サイトサービスを充実させ、サービス品質を向上させる。

### システム導入条件：
- 外部取り寄せ在庫機能の整備
- UI/UXの改善
- 業務運用の仕組化

## 要求整理（拡大解釈あり）

### 取り寄せ在庫の取り扱い機能：
- 各仕入先から商品・在庫・単価データを受領し、本サービスで取り扱う品目として使用。
- 受領したデータにマッピング処理を行い、各データを取り扱い可能な形式に加工。
- 現行の基幹DBに反映し、ECサイトで注文可能な在庫情報として掲載。

### 業務運用の仕組み化：
- 取り寄せ在庫商品の取り扱いを円滑に進めるための以下の仕組み整備：
    - 仕入先各社の異なるデータ形式に対応する汎用化。
    - 入力データの判定プロセスを標準化し、自社で取り扱えるようにする。
    - ECサイトに取り扱い在庫として掲載。
    - 注文受付後の業務プロセスを既存の仕組みとの統合および改善。

## 取り寄せ在庫導入に向けた考察

### 取り寄せ在庫取り扱いプロセス：
- 取り扱い交渉
- データ受領
- マッピング設定
- データ取込
- マスタ整備
- 掲載開始
- 注文後処理

### 準備プロセスと運用プロセスが必要です。

### 考慮すべきポイント：
- 対象仕入先の会社信用度
- 取り扱い商品や価格帯
- データ提供の形式、種類、サイクル
- 注文条件の有無
- 納入先制限
- 出荷先情報提供義務の有無と提供形式

### 運用面のポイントも考慮：
- データ受領の時間順守度
- 受領データの精度
- 納期遵守率
- 新規取扱商品の頻度
- 注文プロセスの安定度
- サポート品質

## 取り寄せ在庫システム検討

### 取り寄せ在庫表示までのシステム機能：

#### 準備段階：
- データ受領、マッピング設定、マッピングルールを整備。

#### 運用段階：
- 受領データを処理するためのバッチ処理が行われ、マッピング加工データとマッピングルールを適用。
- 現行システムとの関連付け、そしてECサイトでの商品表示。

### データ構成検討

- 貴社商品マスタ、仕入先ごとの型番・在庫・単価マスタ、および 外部データの取込単位のテーブル の設計が検討されています。

### 受領データ構成：
- 仕入先ID、仕入先メーカ、仕入先型番、品目ID、MOQ（最小発注数量）、SPQ（最小パッケージ数）、納期、などの項目がデータとして受領されます。

### 新規テーブル構成：
- 品目ID、在庫数、表示用品名、型式、販売単価、原価単価、MOQ、SPQ、納期、仕入先在庫数、仕入先ID などを含む。

### 既存テーブル構成：
- 品目ID、言語ID、詳細ページ品種URL、説明など。
- 仕入先ID、仕入先メーカ、仕入先型番、数量、単価、通貨などの管理が行われます。

## データ受領と加工プロセス

### 受領データ：
- 仕入先から受け取ったデータを基に、マッピング設定を行い、取込・登録バッチを実行します。
- 仕入先型番と貴社型番のマッピング、在庫・単価適用バッチが実行され、貴社商品マスタへ反映されます。

### 運用イメージ：
- データ受領：メールやFTP等で仕入先からデータを受領します。
- マッピング設定：受領したデータを所定の形式にマッピングします。
- 取込処理：データを取込・登録バッチで登録し、必要な情報をECサイトに反映します。

### エラーデータと再取込

#### エラーデータ：
- 中間単価、在庫にエラーがある場合は再取込が行われます。
- 受領データの加工段階でエラーデータが発生する可能性があり、そのデータを修正して再取込を実行します。

#### 処理フロー案：
- 一次加工処理：受領データを中間テーブルに登録し、エラーデータを抽出します。
- 二次加工処理：自社マスタと紐づけ、品目データや単価データを更新します。
- 手動エラー修正：エラーが発生した場合、手動で修正を行い、再取込を実施します。

#### 将来機能化対象：
- 将来的には、エラー処理やデータ取込バッチの完全自動化が目指されます。

## 受領データ取込バッチの詳細

### 取込バッチ機能：
- 受領したデータファイルを基に、中間テーブルへ登録します。
- 各仕入先から提供される異なるフォーマットを統一フォーマットの中間テーブルに登録し、登録はマッピングの条件に従って行います。

### 取込単位で取込管理No.を自動採番し、スケジュールに合わせて処理が実行されます。

### 在庫・単価データ登録バッチ：
- 中間テーブルを基に、仕入先型番、在庫、単価のデータテーブルへ登録・更新します。
- 初回登録時には、貴社品目IDが割り当てられず、貴社品目ID割り当て済みの商品のみ登録されます。
- エラーデータは再取込テーブルで保持し、修正後に再取込を行います。

## 過去データ削除

### 過去データの管理：
- 仕入先在庫・単価データは、取込ファイルに存在する商品のみ登録・更新されます。
- 仕入先が売り切れ等で取込ファイルに含まれなくなった商品は残らないよう、削除処理が必要です。

### 課題検討：
- 取込管理No.を基に、過去に登録されていたデータを整理し、削除します。登録済みデータと今回のデータを比較して、古いデータを一括削除する仕組みを作成します。

## システム開発ステップ案

### スモールスタートを考慮：
開発は3つのステップに分けて実施予定です。各ステップは段階的に機能を拡充していきます。

#### STEP1：
- 取り寄せ在庫機能 Ver.1（基本的な取り寄せ在庫の取り扱い機能を構築）。

#### STEP2：
- 取り寄せ在庫機能 Ver.2（Ver.1の機能を拡張し、さらに多くの機能を加える）。

#### STEP3：
- 既存UI/UX改善（ユーザーインターフェースと体験を改善し、使いやすさを向上させる）。

## システム構成案

### 前提条件：
システムは独立した構成を採用し、スケーラブルで柔軟な運用を可能にします。

### 構成：
#### サーバー/ホスティング：
- パブリッククラウド（現時点ではAWSを想定）。

#### OS：
- Linux（Windowsはコストが高く、運用制約が多いため、Linuxが選択されています）。

#### データベース：
- PostgreSQL（AuroraまたはRDSを使用予定）。

#### バックエンド技術：
- **Java (SpringBoot)**を使用します。

#### フロントエンド技術：
- **HTML5、CSS3、JavaScript (Vue.js)**を使用。

#### 補足：
オンプレミスでも構成は可能ですが、パブリッククラウドを選択することで柔軟性とスケーラビリティを確保します。

## システム構成案（ソフトウェア）

### バックエンド：
システムのコア機能はバックエンドで処理され、データの管理やロジックが実行されます。

### フロントエンド（PC）：
ユーザーがアクセスするECサイトのインターフェースを提供。外部取り寄せデータの取込処理がフロントエンドから行われます。

### フロントエンド（モバイル）：
モバイル対応機能の開発を予定。同様に外部データの取込をモバイルデバイスから行うことができる。

### 外部取込：
外部の仕入先から受け取るデータの取込処理。

## Appendix

### 検索・詳細・更新・新規登録
**機能：**
- **検索：** 商品や情報を検索する機能。
- **詳細・更新：** 検索結果の詳細情報表示と、その情報の更新機能。
- **新規登録：** 新しい商品やデータの登録機能。
- **中間用マッピング：** 外部データを取り込む際のデータマッピング設定。
- **登録用マッピング：** 取り込んだデータを登録する際のマッピング設定。
- **仕入先型番メンテナンス：** 仕入先の型番を管理するメンテナンス機能。

### 中間テーブルとマッピング設定
**中間テーブル項目と取込ファイル項目の設定：**
- 仕入先ID、仕入先メーカ、仕入先型番、品目ID、MOQ、SPQ、納期 などが中間テーブルの項目として設定されます。
- L/T（Lead time）、MOQ、SPQ、在庫数などの項目もマッピングされ、データの整合性を確保します。

**計算条件・一致条件：**
取り込むデータに対して、条件に従い処理を行い、「真」「偽」の条件によってデータが処理されます。

### マッピング設定例

**設定例：**
- 仕入先メーカ：取込ファイルの「Manufacturer」を中間テーブルの「仕入先メーカ」にマッピング。
- L/T（Lead time）：一致条件で「以上」、固定条件で「1」が設定され、条件に合致すれば「真」として処理されます。
- 在庫数：一致条件で「以上」、固定条件で「1」が設定され、条件に合致すれば入力データがそのまま登録されます。
- 説明：取込ファイル項目で指定がない場合、中間テーブルの「説明」カラムにはデータが登録されません。

### マッピング設定詳細（続き）

詳細設定：
- 仕入先型番、納期、MOQ、SPQなどの商品管理情報が、外部データと内部データベースの間でマッピングされ、適切に処理されます。
- 各項目に対して、複数の条件が指定可能で、処理フローが柔軟に設定できることを示しています。
